version: 2

jobs:
  test:
    docker:
      - image: circleci/rust:latest
    steps:
      - checkout
      - run:
          name: Install Dependencies
          command: |
              cargo install cargo-audit
              rustup component add clippy
              mkdir -p "$HOME/bin"
              wget -q https://github.com/ethereum/solidity/releases/download/v0.6.6/solc-static-linux -O $HOME/bin/solc
              chmod u+x "$HOME/bin/solc"
              export PATH=$HOME/bin:$PATH
              solc --version
      - run:
          name: Tests
          command: |
              export PATH=$HOME/bin:$PATH
              cargo test --all
      - run:
          name: Check style
          command: |
              cargo fmt --all -- --check
              cargo clippy --all-targets --all-features -- -D warnings
      - run:
          name: Audit Dependencies
          command: cargo audit --ignore RUSTSEC-2019-0031 # ignore lazy static warning

workflows:
  version: 2
  build_and_test:
    jobs:
      - test
